<div class="container py-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-3" *ngIf="showTopRow">
    <h2 class="h5 mb-0" id="header-activity-select">Select an Activity</h2>
    <button class="btn btn-primary"><i class="fa-solid fa-filter"></i> Filter</button>
  </div>

  <!-- Scrollable Table -->
  <div class="table-responsive">
    <table class="table table-hover table-bordered table-auto">
      <thead class="table-dark">
        <tr>
          <th class="first-col">
            <input type="checkbox" class="form-check-input" [checked]="this.activities != null && this.selected.size===this.activities.length" (change)="selectAll()">
          </th>
          <th *ngFor="let col of columns">{{ col }}</th>
        </tr>
      </thead>


      <tbody *ngIf="!loading && activities!=null && shownActivities!=null && (activities.length==0||shownActivities.length>0); else loadingTemplate">
        <tr *ngIf="activities==null || activities.length == 0">
          <td [attr.colspan]="columns.length+1" class="text-center">
            No activities yet. You can create one by clicking the upload icon (<i class="fa-solid fa-upload"></i>) bottom left.
          </td>
        </tr>
        <tr *ngFor="let activity of shownActivities; let i = index"
          #popover="ngbPopover"
          [ngbPopover]="popoverContent"
          triggers="hover"
          [popoverContext]="{ activityId: activity.id }"
          [openDelay]="300"
          [positionTarget]="'.popover-target-activity'+i"
          popoverClass="custom-popover"
        >
          <td>
            <input type="checkbox" class="form-check-input" [value]="activity.id" [checked]="this.selected.has(activity.id)" (change)="toggle(activity.id)">
          </td>
          <td *ngFor="let col of columns; first as isFirst;">
            <div *ngIf="col === 'Name'" class="popover-target-activity{{i}}">{{ getXFromY(col, activity) }}</div>
            <div *ngIf="col !== 'Name'">{{ getXFromY(col, activity) }}</div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="d-flex justify-content-center align-items-center">
      <span class="fw-bold me-1">{{minShownHTML}}-{{maxShownHTML}}</span> of {{total}}
      <button class="btn btn-sm btn-light ms-2 clickable" [disabled]="currentPage==0" (click)="goPrevious()"><i class="fa-solid fa-arrow-left"></i></button>
      <button class="btn btn-sm btn-light ms-1 clickable" [disabled]="currentPage==lastPage" (click)="goNext()"><i class="fa-solid fa-arrow-right"></i></button>
    </div>
  </div>

  <!-- Footer Section -->
  <div class="d-flex justify-content-end mt-3">
    <button class="btn btn-warning mx-2" (click)="selectAll()">{{ shouldSelectAll ? "Select all" : "Deselect all"}}</button>
    <button class="btn btn-success" (click)="onSubmit()" [disabled]="selected.size==0" id="btn-submit-activities">{{submitText}} <span *ngIf="selected.size>1">({{selected.size}})</span></button>
  </div>
</div>


<ng-template #popoverContent class="asdasd">
  <div #mapContainer class="map-container" id="popoverMapActivities"></div>
</ng-template>

<ng-template #loadingTemplate>
  <tbody id="loading">
    <tr>
      <td [attr.colspan]="columns.length + 1" class="text-center">
        <div class="spinner-border mt-4" role="status"></div>
        <div class="mb-4">Loading activities...</div>
      </td>
    </tr>
  </tbody>
</ng-template>
