<div class="container py-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-3" *ngIf="showTopRow">
    <h2 class="h5 mb-0">Select an Activity</h2>
    <button class="btn btn-primary"><i class="fa-solid fa-filter"></i> Filter</button>
  </div>

  <!-- Scrollable Table -->
  <div class="table-responsive">
    <table class="table table-hover table-bordered table-auto">
      <thead class="table-dark">
        <tr>
          <th class="first-col">
            <input type="checkbox" class="form-check-input" [checked]="this.routes != null && this.selected.size===this.routes.length" (change)="selectAll()">
          </th>
          <th *ngFor="let col of columns">{{ col }}</th>
        </tr>
      </thead>
      <tbody *ngIf="!loading; else loadingTemplate">
            <tr *ngIf="routes==null || routes.length == 0">
              <td [attr.colspan]="columns.length+1" class="text-center">
                No routes yet.
              </td>
            </tr>

        <tr *ngFor="let route of routes; let i = index"
          #popover="ngbPopover"
          [ngbPopover]="popoverContent"
          triggers="hover"
          [popoverContext]="{ activityId: route.id }"
          [openDelay]="300"
          [positionTarget]="'.popover-target'+i"
          popoverClass="custom-popover"
        >
          <td>
            <input type="checkbox" class="form-check-input" [value]="route.id" [checked]="this.selected.has(route.id)" (change)="toggle(route.id)">
          </td>
          <td *ngFor="let col of columns; first as isFirst;">
            <div *ngIf="col === 'Name'" class="popover-target{{i}}">{{ getXFromY(col, route) }}</div>
            <div *ngIf="col !== 'Name'">{{ getXFromY(col, route) }}</div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Footer Section -->
  <div class="d-flex justify-content-end mt-3">
    <button class="btn btn-warning mx-2" (click)="selectAll()">{{ shouldSelectAll ? "Select all" : "Deselect all"}}</button>
    <button class="btn btn-success" (click)="onSubmit()">{{submitText}}</button>
  </div>
</div>


<ng-template #popoverContent class="asdasd">
  <div #mapContainer class="map-container" id="popoverMap"></div>
</ng-template>

<ng-template #loadingTemplate>
  <tbody>
    <tr>
      <td [attr.colspan]="columns.length + 1" class="text-center">
        <div class="spinner-border mt-4" role="status"></div>
        <div class="mb-4">Loading routes...</div>
      </td>
    </tr>
  </tbody>
</ng-template>
